name: Create-VM

on:
  push:
    branches:
      - main

jobs:
  deploy_vm:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Repository
      uses: actions/checkout@v2

    - name: Deploy VM
      run: |
        az group create --name VirtualMachines --location eastus
        az deployment group create --resource-group VirtualMachines --template-uri https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/101-vm-simple-linux/azuredeploy.json --parameters https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/101-vm-simple-linux/azuredeploy.parameters.json --parameters adminUsername=akhilvn@avnstudies.onmicrosoft.com servicePrincipalClientId=9d1f68a9-bc36-4e73-82b5-f2bee8ec1176 servicePrincipalSecret=-u.8Q~LwuEqQXvhSJs7EO7tfE7Ohn4fJPHkG.bZV vmName=test

    - name: Set VM Outputs
      run: |
        VM_IP=$(az vm show -d --resource-group VirtualMachines --name test --query publicIps --output tsv)
        echo "VM IP Address: $VM_IP"
        echo "VM Outputs: $VM_IP" >> $GITHUB_ENV

    - name: Show VM Outputs
      run: |
        cat $GITHUB_ENV
